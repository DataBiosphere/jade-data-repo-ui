FROM node:14

# Install java to run codegen
RUN apt-get update && \
    apt-get install -y software-properties-common && \
    add-apt-repository ppa:openjdk-r/ppa && \
    apt-get update && \
    apt-get install -y default-jre

COPY . /

RUN npm ci && \
  npm run build --production

# Uninstall java
RUN apt purge -y default-jre

FROM nginxinc/nginx-unprivileged:stable-alpine
COPY --from=0 /build /usr/share/nginx/html
